!function(){"use strict";function t(t,e,n,i){this.x=t,this.y=e,this.width=n,this.height=i}function e(t,e,n,i,o){let r=new Image;r.addEventListener("error",function(){console.log("Image failed!")},!1),r.addEventListener("load",function(){console.log("Onload function firing"),this.loaded=!0},!1),r.src=t,this.loaded=!1,this.row=i,this.col=o,this.frames=e,this.frameRate=n,this.timer=0,this.currentFrame=0,this.image=r}function n(t,e,n,i){this.x=t,this.y=e,this.time=0,this.width=n,this.height=i}function i(t,e){n.call(this,t,e,40,40),this.rangeOfMovement=4,this.move(0)}function o(t,e,i,o){n.call(this,t,e,40,10),this.invisPointY=o,this.speed=i}let r,s,c;t.prototype.left=function(){return this.x},t.prototype.right=function(){return this.x+this.width},t.prototype.top=function(){return this.y},t.prototype.bottom=function(){return this.y+this.height},t.prototype.intersects=function(t){return this.right()>=t.left()&&this.left()<=t.right()&&this.top()<=t.bottom()&&this.bottom()>=t.top()},t.prototype.union=function(t){var e,n,i,o;void 0!==t&&(e=Math.min(this.x,t.x),n=Math.min(this.y,t.y),i=Math.max(this.right(),t.right())-Math.min(this.left(),t.left()),o=Math.max(this.bottom(),t.bottom())-Math.min(this.top(),t.top()),this.x=e,this.y=n,this.width=i,this.height=o)},e.prototype.update=function(t){this.timer+=t,this.timer>1/this.frameRate&&(this.timer=0,this.currentFrame=(this.currentFrame+1)%this.frames)},n.prototype.update=function(t){this.time+=t},n.prototype.collisionRect=function(){return new t(this.x-this.width/2,this.y-this.height/2,this.width,this.height)},i.prototype=Object.create(n.prototype),i.prototype.update=function(t){n.prototype.update.call(this,t)},i.prototype.move=function(t){this.x=r.INITIAL_WIDTH()/this.rangeOfMovement*t+20},o.prototype=Object.create(n.prototype),o.prototype.update=function(t){n.prototype.update.call(this,t),this.y+=this.speed},c=function(){let t=[];return{update:function(e){let n,i=s.enemies(),o=s.player(),c=o.collisionRect();for(n=i.length-1;n>=0;n--){let e=i[n],a=e.collisionRect();e&&o&&a.intersects(c)?s.setGameOver():e&&a.top()>r.INITIAL_HEIGHT()&&(t.push(e),s.addScore(1))}},clearOffScreenEntities:function(){t&&(t=t.filter(function(e){return!t.includes(e)}))},offScreenEntities:function(){return t}}}(),r=function(){let t=new e("sprites/animals.png",1,1,3,4),n=new e("sprites/animals.png",3,3,4,6),r=[].concat(t,n),c=document.getElementById("gameWindow"),a=c.getContext("2d");const h=720,u=480,f=u/h;let l=h,d=u,p=navigator.userAgent.toLowerCase(),g=p.indexOf("android")>-1,m=p.indexOf("iphone")>-1||p.indexOf("ipad")>-1;function y(){l=window.innerHeight,d=l*f,(g||m)&&(document.body.style.height=window.innerHeight+50+"px"),c.style.width=d+"px",c.style.height=l+"px",window.setTimeout(function(){window.scrollTo(0,1)},1)}function I(t,e){let n=t.image.height/t.frames,i=t.image.width/t.frames;a.drawImage(t.image,t.col*i+i*t.currentFrame,t.row*n,i,n,e.x,e.y,e.width,e.height)}return c.width=u,c.height=h,y(),window.addEventListener("resize",y,!1),{render:function(e){let c,f,l=s.entities();for(a.fillStyle="blue",a.fillRect(0,0,u,h),f=r.length-1;f>=0;f--)r[f].update(e);for(f=0;f<l.length;f++)(c=l[f])instanceof o?(p=a,(g=c).y<g.invisPointY?n.loaded&&I(n,g):(p.fillStyle="white",p.fillRect(0,g.y+g.height,u,10))):c instanceof i&&(d=c,t.loaded&&I(t,d));var d,p,g},INITIAL_WIDTH:function(){return u},INITIAL_HEIGHT:function(){return h},currentWidth:function(){return d},currentHeight:function(){return l},canvas:function(){return c}}}(),s=function(){let t,e,n,a,h,u,f,l=!0,d=1,p=d,g=!1,m=function(){let t=0,e=2*r.INITIAL_HEIGHT();return function(){let n=(i=4,Math.floor(Math.random()*Math.floor(i)));var i;let s,c;for(t++,console.log("wave "+t),5==t&&(e=r.INITIAL_HEIGHT()/2,console.log("Activating invisibilty gene...")),e>=80&&(e-=10),c=0;c<4;c++)c!==n&&I(new o(s=r.INITIAL_WIDTH()/4*c+20,-10,p,e))}}();function y(){let t;if(l){for(p=0,console.log("STOP..."),t=0;t<n.length;t++)n[t].speed=p;l=!1}else{for(console.log("hammertime"),p=d,t=0;t<n.length;t++)n[t].speed=p,n[t].y+=p;l=!0}}function I(t){e.push(t),t instanceof i?a=t:t instanceof o&&n.push(t)}return{start:function(){if(console.log("game start"),e=[],n=[],h=!1,u=0,f=[],t=0,"undefined"!=typeof Storage)try{f=JSON.parse(localStorage.sharkAttackScores)}catch(t){f=[]}this.addEntity(new i(0,r.INITIAL_HEIGHT()-60)),m(),g||(requestAnimationFrame(this.update.bind(this)),g=!0)},update:function(i){let s,u,f=[],d=!1,p=a.y-a.height,I=r.INITIAL_HEIGHT()/4,w=Math.min((i-t)/1e3,.05);if(t=i,h)g=!1;else{for(c.update(w),u=0;u<e.length;u++)(s=e[u]).update(w),s instanceof o&&!d&&s.y>=I&&s.y<I+s.speed&&(m(),d=!0),s instanceof o&&l&&s.y>=p&&s.y<p+s.speed&&y(),c.offScreenEntities().includes(s)&&f.push(s);!function(t){function i(e){return!t.includes(e)}t&&(e=e.filter(i),n=n.filter(i),t.includes(a)&&(a=void 0))}(f),c.clearOffScreenEntities(),d=!1,r.render(w),requestAnimationFrame(this.update.bind(this))}},addEntity:I,setGameOver:function(){var t;h||(console.log("game over"),h=!0,t=Math.round(s.score()),f.push(t),f.sort(function(t,e){return e-t}),f=f.slice(0,10),"undefined"!=typeof Storage&&(localStorage.invadersScores=JSON.stringify(f)))},addScore:function(t){u+=t},toggleAcceleration:y,accelerating:function(){return l},score:function(){return u},highScores:function(){return f},gameOver:function(){return h},entities:function(){return e},enemies:function(){return n},player:function(){return a}}}();let a={49:0,50:1,51:2,52:3};function h(t){let e=r.currentWidth()/r.INITIAL_WIDTH();return{x:(t.pageX-function(t){let e=0;do{isNaN(t.offsetLeft)||(e+=t.offsetLeft),t=t.offsetParent}while(null!==t);return e}(r.canvas()))/e,y:(t.pageY-function(t){let e=0;do{isNaN(t.offsetTop)||(e+=t.offsetTop),t=t.offsetParent}while(null!==t);return e}(r.canvas()))/e}}document.body.addEventListener("keydown",function(t){let e=t.which||t.keyCode;void 0!==a[e]&&(t.preventDefault(),s.player()&&s.player().move(a[e]),s.accelerating()||s.toggleAcceleration())}),r.canvas().addEventListener("touchstart",function(t){let e,n,i=t.changedTouches;t.preventDefault();for(let t=i.length-1;t>=0;t--)n=(e=h(i[t])).x<.25*r.INITIAL_WIDTH()?0:e.x<.5*r.INITIAL_WIDTH()?1:e.x<.75*r.INITIAL_WIDTH()?2:3,s.player().move(n),s.accelerating()||s.toggleAcceleration()}),s.start()}();